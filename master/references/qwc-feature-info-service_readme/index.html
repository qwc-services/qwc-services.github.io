<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Qwc feature info service readme - QWC - 2025.10.02</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../css/custom.css" rel="stylesheet" />
        <link href="../../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Qwc feature info service readme";
        var mkdocs_page_input_path = "references/qwc-feature-info-service_readme.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> QWC - 2025.10.02
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">QWC</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../QuickStart/">Quick start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">General configuration</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ThemesConfiguration/">Themes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ViewerConfiguration/">Viewer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ResourcesPermissions/">Resources and permissions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ServiceConfiguration/">Services</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Selected topics</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Search/">Search</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/FeatureInfo/">Feature info</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Printing/">Printing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/MapExport/">Map export</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Mapinfo/">Map info</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Editing/">Editing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Snapping/">Snapping</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/TimeManager/">Temporal layers</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Tourguide/">Tour Guide</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/LegendGraphics/">Legend graphics</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/MapFilter/">Map filtering</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Reports/">Reports</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/View3D/">3D View</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Translations/">Translations</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Interfacing/">Interfacing with applications</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/MultiTenancy/">Multi-tenancy</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../">References</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Version history</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/ChangeLog/">ChangeLog</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/QWC2UpgradeNotes/">QWC2 upgrade notes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/QwcDockerUpgradeNotes/">qwc-docker upgrade notes</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../UserGuide/">User guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../FAQ/">FAQ</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">QWC - 2025.10.02</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Qwc feature info service readme</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p><a href="https://github.com/qwc-services/qwc-feature-info-service/actions"><img alt="" src="https://github.com/qwc-services/qwc-feature-info-service/workflows/build/badge.svg" /></a>
<a href="https://hub.docker.com/r/sourcepole/qwc-feature-info-service"><img alt="docker" src="https://img.shields.io/docker/v/sourcepole/qwc-feature-info-service?label=Docker%20image&amp;sort=semver" /></a></p>
<h1 id="qwc-featureinfo-service">QWC FeatureInfo Service<a class="headerlink" href="#qwc-featureinfo-service" title="Permanent link">&para;</a></h1>
<p>Query layers at a geographic position using an API based on WMS GetFeatureInfo.</p>
<p>The query is handled for each layer by its layer info provider configured in the config file.</p>
<p>Layer info providers:</p>
<ul>
<li>WMS GetFeatureInfo (default): forward info request to the QGIS Server</li>
<li>DB Query: execute custom query SQL</li>
<li>Custom info module: custom Python modules returning layer info</li>
</ul>
<p>The info results are each rendered into customizable HTML templates and returned as a GetFeatureInfoResponse XML.</p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<p>The DB query uses a PostgreSQL connection service or connection to a PostGIS database.
This connection's user requires read access to the configured tables.</p>
<h3 id="qwc_demo-example">qwc_demo example<a class="headerlink" href="#qwc_demo-example" title="Permanent link">&para;</a></h3>
<p>Uses PostgreSQL connection service <code>qwc_geodb</code> (GeoDB).
The user <code>qwc_service</code> requires read access to the configured tables
of the data layers from the QGIS project <code>qwc_demo.qgs</code>.</p>
<p>Setup PostgreSQL connection service file <code>~/.pg_service.conf</code>:</p>
<pre><code>[qwc_geodb]
host=localhost
port=5439
dbname=qwc_demo
user=qwc_service
password=qwc_service
sslmode=disable
</code></pre>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>The static config and permission files are stored as JSON files in <code>$CONFIG_PATH</code> with subdirectories for each tenant,
e.g. <code>$CONFIG_PATH/default/*.json</code>. The default tenant name is <code>default</code>.</p>
<h3 id="featureinfo-service-config">FeatureInfo Service config<a class="headerlink" href="#featureinfo-service-config" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="../schemas/qwc-feature-info-service.json">JSON schema</a></li>
<li>File location: <code>$CONFIG_PATH/&lt;tenant&gt;/featureInfoConfig.json</code></li>
</ul>
<p>Note: Use the <code>qwc-config-generator</code> to automatically generate the resource configuration. Manually provided configuration is merged into the automatically generated configuration by service and layer name. I.e. the configuration for <code>countries</code> in the example below just specifies the info template, attributes configuration will completed by the config generator.</p>
<p>Example:</p>
<pre><code class="language-json">{
  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/qwc-services/qwc-feature-info-service/master/schemas/qwc-feature-info-service.json&quot;,
  &quot;service&quot;: &quot;feature-info&quot;,
  &quot;config&quot;: {
    &quot;default_qgis_server_url&quot;: &quot;http://localhost:8001/ows/&quot;
  },
  &quot;resources&quot;: {
    &quot;wms_services&quot;: [
      {
        &quot;name&quot;: &quot;qwc_demo&quot;,
        &quot;root_layer&quot;: {
          &quot;name&quot;: &quot;qwc_demo&quot;,
          &quot;layers&quot;: [
            {
              &quot;name&quot;: &quot;edit_demo&quot;,
              &quot;title&quot;: &quot;Edit Demo&quot;,
              &quot;layers&quot;: [
                {
                  &quot;name&quot;: &quot;edit_points&quot;,
                  &quot;title&quot;: &quot;Edit Points&quot;,
                  &quot;attributes&quot;: [
                    {
                      &quot;name&quot;: &quot;id&quot;
                    },
                    {
                      &quot;name&quot;: &quot;name&quot;
                    },
                    {
                      &quot;name&quot;: &quot;description&quot;
                    },
                    {
                      &quot;name&quot;: &quot;num&quot;
                    },
                    {
                      &quot;name&quot;: &quot;value&quot;
                    },
                    {
                      &quot;name&quot;: &quot;type&quot;
                    },
                    {
                      &quot;name&quot;: &quot;amount&quot;
                    },
                    {
                      &quot;name&quot;: &quot;validated&quot;,
                      &quot;format&quot;: &quot;{\&quot;t\&quot;: \&quot;Yes\&quot;, \&quot;f\&quot;: \&quot;No\&quot;}&quot;
                    },
                    {
                      &quot;name&quot;: &quot;datetime&quot;
                    },
                    {
                      &quot;name&quot;: &quot;geometry&quot;
                    },
                    {
                      &quot;name&quot;: &quot;maptip&quot;
                    }
                  ]
                }
              ]
            },
            {
              &quot;name&quot;: &quot;countries&quot;,
              &quot;info_template&quot;: {
                &quot;type&quot;: &quot;wms&quot;,
                &quot;wms_url&quot;: &quot;http://localhost:8001/ows/qwc_demo&quot;,
                &quot;template&quot;: &quot;&lt;div&gt;&lt;h2&gt;Demo Template&lt;/h2&gt;Pos: {{ x }}, {{ y }}&lt;br&gt;Name: {{ feature.Name }}&lt;/div&gt;&quot;
              }
            }
          ]
        }
      }
    ]
  }
}
</code></pre>
<p>Example <code>info_template</code> for WMS GetFeatureInfo:</p>
<pre><code class="language-json">&quot;info_template&quot;: {
  &quot;type&quot;: &quot;wms&quot;,
  &quot;wms_url&quot;: &quot;http://localhost:8001/ows/qwc_demo&quot;,
  &quot;template&quot;: &quot;&lt;div&gt;&lt;h2&gt;Demo Template&lt;/h2&gt;Pos: {{ x }}, {{ y }}&lt;br&gt;Name: {{ feature.Name }}&lt;/div&gt;&quot;
}
</code></pre>
<p>Example <code>info_template</code> for WMS GetFeatureInfo with template path:</p>
<pre><code class="language-json">&quot;info_template&quot;: {
  &quot;type&quot;: &quot;wms&quot;,
  &quot;wms_url&quot;: &quot;http://localhost:8001/ows/qwc_demo&quot;,
  &quot;template_path&quot;: &quot;/info_templates/template.html&quot;
}
</code></pre>
<p>Example <code>info_template</code> for DB query:</p>
<pre><code class="language-json">&quot;info_template&quot;: {
  &quot;type&quot;: &quot;sql&quot;,
  &quot;db_url&quot;: &quot;postgresql:///?service=qwc_geodb&quot;,
  &quot;sql&quot;: &quot;SELECT ogc_fid as _fid_, name, formal_en, pop_est, subregion, ST_AsText(wkb_geometry) as wkt_geom FROM qwc_geodb.ne_10m_admin_0_countries WHERE ST_Intersects(wkb_geometry, ST_GeomFromText(:geom, :srid)) LIMIT :feature_count;&quot;,
  &quot;template&quot;: &quot;&lt;div&gt;&lt;h2&gt;Demo Template&lt;/h2&gt;Pos: {{ x }}, {{ y }}&lt;br&gt;Name: {{ feature.Name }}&lt;/div&gt;&quot;
}
</code></pre>
<p>Note: <code>x</code>, <code>y</code> and <code>geom</code> are passed as parameters to the SQL query. If a <code>GetFeatureInfo</code> request is being processed with a <code>filter_geom</code> parameter, <code>geom</code> will correspond to that parameter. Otherwise <code>geom</code> will be <code>POINT(x y)</code>.</p>
<p>Example <code>info_template</code> for Custom info module:</p>
<pre><code class="language-json">&quot;info_template&quot;: {
  &quot;type&quot;: &quot;module&quot;,
  &quot;module&quot;: &quot;example&quot;,
  &quot;template&quot;: &quot;&lt;div&gt;&lt;h2&gt;Demo Template&lt;/h2&gt;Pos: {{ x }}, {{ y }}&lt;br&gt;Name: {{ feature.Name }}&lt;/div&gt;&quot;
}
</code></pre>
<h4 id="base64-encoded-properties">Base64 encoded properties<a class="headerlink" href="#base64-encoded-properties" title="Permanent link">&para;</a></h4>
<p>The following config properties may also be set as Base64 encoded values instead:</p>
<ul>
<li>Default HTML info template: <code>default_info_template_base64</code></li>
<li>Formatting expression for converting attribute values: <code>format_base64</code></li>
<li>HTML template for info result: <code>template_base64</code></li>
<li>Query SQL for DB query: <code>sql_base64</code></li>
</ul>
<p>Any plain text properties take precedence over their corresponding Base64 encoded property (e.g. <code>template_base64</code> is only used if <code>template</code> is not set).</p>
<h3 id="permissions">Permissions<a class="headerlink" href="#permissions" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/qwc-services/qwc-services-core/blob/master/schemas/qwc-services-permissions.json">JSON schema</a></li>
<li>File location: <code>$CONFIG_PATH/&lt;tenant&gt;/permissions.json</code></li>
</ul>
<p>Example:</p>
<pre><code class="language-json">{
  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/qwc-services/qwc-services-core/master/schemas/qwc-services-permissions.json&quot;,
  &quot;users&quot;: [
    {
      &quot;name&quot;: &quot;demo&quot;,
      &quot;groups&quot;: [&quot;demo&quot;],
      &quot;roles&quot;: []
    }
  ],
  &quot;groups&quot;: [
    {
      &quot;name&quot;: &quot;demo&quot;,
      &quot;roles&quot;: [&quot;demo&quot;]
    }
  ],
  &quot;roles&quot;: [
    {
      &quot;role&quot;: &quot;public&quot;,
      &quot;permissions&quot;: {
        &quot;wms_services&quot;: [
          {
            &quot;name&quot;: &quot;qwc_demo&quot;,
            &quot;ows_type&quot;: &quot;WMS&quot;,
            &quot;layers&quot;: [
              {
                &quot;name&quot;: &quot;qwc_demo&quot;
              },
              {
                &quot;name&quot;: &quot;edit_demo&quot;
              },
              {
                &quot;name&quot;: &quot;edit_points&quot;,
                &quot;attributes&quot;: [
                  &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;,
                  &quot;datetime&quot;, &quot;geometry&quot;, &quot;maptip&quot;
                ]
              },
              {
                &quot;name&quot;: &quot;countries&quot;,
                &quot;attributes&quot;: [&quot;name&quot;, &quot;formal_en&quot;, &quot;pop_est&quot;, &quot;subregion&quot;, &quot;geometry&quot;],
                &quot;info_template&quot;: true
              }
            ]
          }
        ]
      }
    }
  ]
}
</code></pre>
<h3 id="basic-auth">Basic Auth<a class="headerlink" href="#basic-auth" title="Permanent link">&para;</a></h3>
<p>The feature info service be configured to accept password authentication using Basic authentication.</p>
<p>Example:</p>
<pre><code class="language-json">  &quot;config&quot;: {
    &quot;basic_auth_login_url&quot;: [&quot;http://qwc-auth-service:9090/verify_login&quot;]
  },
</code></pre>
<h2 id="html-template">HTML template<a class="headerlink" href="#html-template" title="Permanent link">&para;</a></h2>
<p>A HTML template can be provided for a layer in the config file.
The template must only contain the body content (without <code>head</code>, <code>script</code>, <code>body</code>).
The HTML can be styled using inline CSS, otherwise the CSS from the QWC viewer is used.</p>
<p>This template can contain attribute value placeholders, in the form</p>
<pre><code>{{ feature.attr }}
</code></pre>
<p>which are replaced with the respective values when the template is rendered (using <a href="http://jinja.pocoo.org/">Jinja2</a>).
The following values are available in the template:</p>
<ul>
<li><code>x</code>, <code>y</code>, <code>crs</code>: Coordinates and CRS of info query</li>
<li><code>feature</code>: Feature with attributes from info result as properties, e.g. <code>feature.name</code></li>
<li><code>fid</code>: Feature ID (if present)</li>
<li><code>bbox</code>: Feature bounding box as <code>[&lt;minx&gt;, &lt;miny&gt;, &lt;maxx&gt;, &lt;maxy&gt;]</code> (if present)</li>
<li><code>geometry</code>: Feature geometry as WKT (if present)</li>
<li><code>layer</code>: Layer name</li>
</ul>
<p>To automatically detect hyperlinks in values and replace them as HTML links the following helper can be used in the template:</p>
<pre><code>render_value(value)
</code></pre>
<p>Example:</p>
<pre><code class="language-xml">    &lt;div&gt;Result at coordinates {{ x }}, {{ y }}&lt;/div&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;Name:&lt;/td&gt;
            &lt;td&gt;{{ feature.name }}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;Description:&lt;/td&gt;
            &lt;td&gt;{{ feature.description }}&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
</code></pre>
<h3 id="default-info-template">Default info template<a class="headerlink" href="#default-info-template" title="Permanent link">&para;</a></h3>
<p>Layers with no assigned info templates use WMS GetFeatureInfo with a default info template.
The default template can also optionally be configured as <code>default_info_template</code> in the config file.</p>
<p>The InfoFeature <code>feature</code> available in the template also provides a list of its attributes:</p>
<pre><code>feature._attributes = [
    'name': &lt;attribute name&gt;,
    'value': &lt;attribute value&gt;,
    'alias': &lt;attribute alias&gt;,
    'type': &lt;attribute value data type as string&gt;,
    'json_aliases': &lt;JSON attribute aliases as {'json_key': 'value'}&gt;
]
</code></pre>
<p>If an attribute value starts with <code>{</code> or <code>[</code> the service tries to parse it as JSON before rendering it in the template.</p>
<p>Default info template:</p>
<pre><code class="language-xml">    &lt;table class=&quot;attribute-list&quot;&gt;
        &lt;tbody&gt;
        {% for attr in feature._attributes -%}
            {% if attr['type'] == 'list' -%}
                {# attribute is a list #}
                &lt;tr&gt;
                    &lt;td class=&quot;identify-attr-title wrap&quot;&gt;&lt;i&gt;{{ attr['alias'] }}&lt;/i&gt;&lt;/td&gt;
                    &lt;td&gt;
                        &lt;table class=&quot;identify-attr-subtable&quot;&gt;
                            &lt;tbody&gt;
                            {%- for item in attr['value'] %}
                                    {%- if item is mapping -%}
                                        {# item is a dict #}
                                        {% for key in item -%}
                                            {% if not attr['json_aliases'] %}
                                                {% set alias = key %}
                                            {% elif key in attr['json_aliases'] %}
                                                {% set alias = attr['json_aliases'][key] %}
                                            {% endif %}
                                            {% if alias %}
                                                &lt;tr&gt;
                                                    &lt;td class=&quot;identify-attr-title wrap&quot;&gt;
                                                        &lt;i&gt;{{ alias }}&lt;/i&gt;
                                                    &lt;/td&gt;
                                                    &lt;td class=&quot;identify-attr-value wrap&quot;&gt;
                                                        {{ render_value(item[key]) }}
                                                    &lt;/td&gt;
                                                &lt;/tr&gt;
                                            {% endif %}
                                        {%- endfor %}
                                    {%- else -%}
                                        &lt;tr&gt;
                                            &lt;td class=&quot;identify-attr-value identify-attr-single-value wrap&quot; colspan=&quot;2&quot;&gt;
                                                {{ render_value(item) }}
                                            &lt;/td&gt;
                                        &lt;/tr&gt;
                                    {%- endif %}
                                    &lt;tr&gt;
                                        &lt;td class=&quot;identify-attr-spacer&quot; colspan=&quot;2&quot;&gt;&lt;/td&gt;
                                    &lt;/tr&gt;
                            {%- endfor %}
                            &lt;/tbody&gt;
                        &lt;/table&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;

            {%- elif attr['type'] in ['dict', 'OrderedDict'] -%}
                {# attribute is a dict #}
                &lt;tr&gt;
                    &lt;td class=&quot;identify-attr-title wrap&quot;&gt;&lt;i&gt;{{ attr['alias'] }}&lt;/i&gt;&lt;/td&gt;
                    &lt;td&gt;
                        &lt;table class=&quot;identify-attr-subtable&quot;&gt;
                            &lt;tbody&gt;
                            {% for key in attr['value'] -%}
                                &lt;tr&gt;
                                    &lt;td class=&quot;identify-attr-title wrap&quot;&gt;
                                        &lt;i&gt;{{ key }}&lt;/i&gt;
                                    &lt;/td&gt;
                                    &lt;td class=&quot;identify-attr-value wrap&quot;&gt;
                                        {{ render_value(attr['value'][key]) }}
                                    &lt;/td&gt;
                                &lt;/tr&gt;
                            {%- endfor %}
                            &lt;/tbody&gt;
                        &lt;/table&gt;
                    &lt;/td&gt;
                &lt;/tr&gt;

            {%- else -%}
                {# other attributes #}
                &lt;tr&gt;
                    &lt;td class=&quot;identify-attr-title wrap&quot;&gt;
                        &lt;i&gt;{{ attr['alias'] }}&lt;/i&gt;
                    &lt;/td&gt;
                    &lt;td class=&quot;identify-attr-value wrap&quot;&gt;
                        {{ render_value(attr['value']) }}
                    &lt;/td&gt;
                &lt;/tr&gt;
            {%- endif %}
        {%- endfor %}
        &lt;/tbody&gt;
    &lt;/table&gt;
</code></pre>
<h2 id="db-query">DB Query<a class="headerlink" href="#db-query" title="Permanent link">&para;</a></h2>
<p>In a DB Query the following values are replaced in the SQL:</p>
<ul>
<li><code>:x</code>: X coordinate of query</li>
<li><code>:y</code>: Y coordinate of query</li>
<li><code>:srid</code>: SRID of query coordinates</li>
<li><code>:resolution</code>: Resolution in map units per pixel</li>
<li><code>:FI_POINT_TOLERANCE</code>: Tolerance for picking points, in pixels (default=16)</li>
<li><code>:FI_LINE_TOLERANCE</code>: Tolerance for picking lines, in pixels (default=8)</li>
<li><code>:FI_POLYGON_TOLERANCE</code>: Tolerance for picking polygons, in pixels (default=4)</li>
<li><code>:i</code>: X ordinate of query point on map, in pixels</li>
<li><code>:j</code>: Y ordinate of query point on map, in pixels</li>
<li><code>:height</code>: Height of map output, in pixels</li>
<li><code>:width</code>: Width of map output, in pixels</li>
<li><code>:bbox</code>: 'Bounding box for map extent as minx,miny,maxx,maxy'</li>
<li><code>:crs</code>: 'CRS for map extent'</li>
<li><code>:feature_count</code>: Max feature count</li>
<li><code>:with_geometry</code>: Whether to return geometries in response (default=1)</li>
<li><code>:with_maptip</code>: Whether to return maptip in response (default=1)</li>
</ul>
<p>The query may return the feature ID as <code>_fid_</code> and the WKT geometry as <code>wkt_geom</code>. All other selected columns are used as feature attributes.</p>
<p>Sample queries:</p>
<pre><code class="language-sql">    SELECT ogc_fid as _fid_, name, ...,
      ST_AsText(wkb_geometry) as wkt_geom
    FROM schema.table
    WHERE ST_Intersects(wkb_geometry, ST_GeomFromText('POINT(:x :y)', :srid))
    LIMIT :feature_count;
</code></pre>
<pre><code class="language-sql">    SELECT ogc_fid as _fid_, name, ...,
      ST_AsText(wkb_geometry) as wkt_geom
    FROM schema.table
    WHERE ST_Intersects(
        wkb_geometry,
        ST_Buffer(
            ST_GeomFromText('POINT(:x :y)', :srid),
            :resolution * :FI_POLYGON_TOLERANCE
        )
    )
    LIMIT :feature_count;
</code></pre>
<h2 id="custom-info-modules">Custom info modules<a class="headerlink" href="#custom-info-modules" title="Permanent link">&para;</a></h2>
<p>Custom info modules can be placed in <code>./info_modules/custom/&lt;module name&gt;/</code> and must provide the following method:</p>
<pre><code class="language-python">def layer_info(layer, x, y, crs, params, identity)
</code></pre>
<p>Input parameters:</p>
<ul>
<li><code>layer</code> (str): Layer name</li>
<li><code>x</code> (float): X coordinate of query</li>
<li><code>y</code> (float): Y coordinate of query</li>
<li><code>crs</code> (str): CRS of query coordinates</li>
<li>
<p><code>params</code> (obj): FeatureInfo service params</p>
<pre><code>{
    'i': &lt;X ordinate of query point on map, in pixels&gt;,
    'j': &lt;Y ordinate of query point on map, in pixels&gt;,
    'height': &lt;Height of map output, in pixels&gt;,
    'width': &lt;Width of map output, in pixels&gt;,
    'bbox': '&lt;Bounding box for map extent as minx,miny,maxx,maxy&gt;',
    'crs': '&lt;CRS for map extent&gt;',
    'feature_count': &lt;Max feature count&gt;,
    'with_geometry': &lt;Whether to return geometries in response
        (default=1)&gt;,
    'with_maptip': &lt;Whether to return maptip in response
        (default=1)&gt;,
    'FI_POINT_TOLERANCE': &lt;Tolerance for picking points, in pixels
        (default=16)&gt;,
    'FI_LINE_TOLERANCE': &lt;Tolerance for picking lines, in pixels
        (default=8)&gt;,
    'FI_POLYGON_TOLERANCE': &lt;Tolerance for picking polygons, in pixels
        (default=4)&gt;,
    'resolution': &lt;Resolution in map units per pixel&gt;
}
</code></pre>
</li>
<li>
<p><code>identity</code> (str): User name or Identity dict</p>
</li>
</ul>
<p>Return info result as a dict:</p>
<pre><code>{
    'features': [
        {
            'id': &lt;feature ID&gt;,  # optional
            'attributes': [
                {
                    'name': '&lt;attribute name&gt;',
                    'value': &lt;attribute value&gt;
                }
            ],
            'bbox': [&lt;minx&gt;, &lt;miny&gt;, &lt;maxx&gt;, &lt;maxy&gt;],  # optional
            'geometry': '&lt;WKT geometry&gt;'  # optional
        }
    ]
}
</code></pre>
<p>See <a href="info_modules/custom/example/"><code>./info_modules/custom/example/</code></a> for a sample implementation of a custom layer info module.</p>
<p>The custom info module can then be referenced in the <code>info_template</code> by its name (= directory name) in the service config.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>Set the <code>CONFIG_PATH</code> environment variable to the path containing the service config and permission files when starting this service (default: <code>config</code>).</p>
<p>Base URL:</p>
<pre><code>http://localhost:5015/
</code></pre>
<p>Service API:</p>
<pre><code>http://localhost:5015/api/
</code></pre>
<p>Sample request:</p>
<pre><code>curl 'http://localhost:5015/qwc_demo?layers=countries,edit_points&amp;i=51&amp;j=51&amp;height=101&amp;width=101&amp;bbox=671639%2C5694018%2C1244689%2C6267068&amp;crs=EPSG%3A3857'
</code></pre>
<h2 id="docker-usage">Docker usage<a class="headerlink" href="#docker-usage" title="Permanent link">&para;</a></h2>
<p>See sample <a href="https://github.com/qwc-services/qwc-docker/blob/master/docker-compose-example.yml">docker-compose.yml</a> of <a href="https://github.com/qwc-services/qwc-docker">qwc-docker</a>.</p>
<h2 id="development">Development<a class="headerlink" href="#development" title="Permanent link">&para;</a></h2>
<p>Install dependencies and run service:</p>
<pre><code>uv run src/server.py
</code></pre>
<p>With config path:</p>
<pre><code>CONFIG_PATH=/PATH/TO/CONFIGS/ uv run src/server.py
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../js/extend-search.js" defer></script>
      <script src="../../search/main.js" defer></script>
      <script src="../../js/version-select.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

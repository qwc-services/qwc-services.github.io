<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Qwc map viewer readme - QWC2 - 2024.08.20-master</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../css/custom.css" rel="stylesheet" />
        <link href="../../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Qwc map viewer readme";
        var mkdocs_page_input_path = "references/qwc-map-viewer_readme.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> QWC2 - 2024.08.20-master
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">QWC2</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../QuickStart/">Quick start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">General configuration</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ThemesConfiguration/">Themes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ViewerConfiguration/">Viewer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ResourcesPermissions/">Resources and permissions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ServiceConfiguration/">Services</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Selected topics</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Search/">Search</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/FeatureInfo/">Feature info</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Printing/">Printing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Mapinfo/">Map info</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Editing/">Editing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Snapping/">Snapping</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/TimeManager/">Temporal layers</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/LegendGraphics/">Legend graphics</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/MapFilter/">Map filtering</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Interfacing/">Interfacing with applications</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/MultiTenancy/">Multi-tenancy</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../">References</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Version history</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/ChangeLog/">ChangeLog</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/QWC2UpgradeNotes/">QWC2 upgrade notes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/QwcDockerUpgradeNotes/">qwc-docker upgrade notes</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../UserGuide/">User guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../FAQ/">FAQ</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">QWC2 - 2024.08.20-master</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Qwc map viewer readme</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p><a href="https://github.com/qwc-services/qwc-map-viewer/actions"><img alt="" src="https://github.com/qwc-services/qwc-map-viewer/workflows/build/badge.svg" /></a>
<a href="https://hub.docker.com/r/sourcepole/qwc-map-viewer-demo"><img alt="docker" src="https://img.shields.io/docker/v/sourcepole/qwc-map-viewer-demo?label=Docker%20image&amp;sort=semver" /></a></p>
<h1 id="qwc-map-viewer">QWC Map Viewer<a class="headerlink" href="#qwc-map-viewer" title="Permanent link">&para;</a></h1>
<p>Provide a <a href="https://github.com/qgis/qwc2-demo-app">QWC2 Web Client</a> application using QWC services.</p>
<p><strong>Note:</strong> Requires a QWC OGC service or QGIS server running on <code>ogc_service_url</code>. Additional QWC Services are optional.</p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h2>
<p>Copy your QWC2 files from a production build (see <a href="https://github.com/qgis/qwc2-demo-app/blob/master/doc/src/quick_start.md">QWC2 Quick start</a>):</p>
<pre><code>SRCDIR=path/to/qwc2-app/prod/ DSTDIR=$PWD
mkdir $DSTDIR/qwc2 &amp;&amp; mkdir $DSTDIR/qwc2/dist
cd $SRCDIR &amp;&amp; \
cp -r assets $DSTDIR/qwc2 &amp;&amp; \
cp -r translations $DSTDIR/qwc2/translations &amp;&amp; \
cp dist/QWC2App.js $DSTDIR/qwc2/dist/ &amp;&amp; \
cp index.html $DSTDIR/qwc2/ &amp;&amp; \
cp config.json $DSTDIR/qwc2/config.json &amp;&amp; \
cd -
</code></pre>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>The static config and permission files are stored as JSON files in <code>$CONFIG_PATH</code> with subdirectories for each tenant,
e.g. <code>$CONFIG_PATH/default/*.json</code>. The default tenant name is <code>default</code>.</p>
<p><strong>Note:</strong>: Custom viewers have been replaced by tenants in v2.</p>
<h3 id="map-viewer-config">Map Viewer config<a class="headerlink" href="#map-viewer-config" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="schemas/qwc-map-viewer.json">JSON schema</a></li>
<li>File location: <code>$CONFIG_PATH/&lt;tenant&gt;/mapViewerConfig.json</code></li>
</ul>
<p>Example:</p>
<pre><code class="language-jsonc">{
  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/qwc-services/qwc-map-viewer/v2/schemas/qwc-map-viewer.json&quot;,
  &quot;service&quot;: &quot;map-viewer&quot;,
  &quot;config&quot;: {
    // path to QWC2 files
    &quot;qwc2_path&quot;: &quot;qwc2/&quot;,
    // QWC OGC service (required)
    &quot;ogc_service_url&quot;: &quot;http://localhost:5013/&quot;,
    // some optional QWC services
    &quot;auth_service_url&quot;: &quot;http://localhost:5017/&quot;,
    &quot;data_service_url&quot;: &quot;http://localhost:5012/&quot;
  },
  &quot;resources&quot;: {
    &quot;qwc2_config&quot;: {
      // restricted menu items
      &quot;restricted_viewer_tasks&quot;: [&quot;RasterExport&quot;],

      &quot;config&quot;: {
        // contents from QWC2 config.json
        &quot;assetsPath&quot;: &quot;/assets&quot;,
        // ...
      }
    },
    &quot;qwc2_themes&quot;: {
      // contents from QWC2 themes.json
      &quot;themes&quot;: {
        &quot;items&quot;: [
          {
            &quot;name&quot;: &quot;qwc_demo&quot;,
            &quot;title&quot;: &quot;Demo&quot;,
            &quot;url&quot;: &quot;/ows/qwc_demo&quot;,
            // ...
            &quot;sublayers&quot;: [
              // ...
            ]
          }
        ],
        &quot;backgroundLayers&quot;: [
          // ...
        ],
        // ...
      }
    }
  }
}
</code></pre>
<p>All <code>config</code> options may be overridden by setting corresponding upper-case environment variables, e.g. <code>OGC_SERVICE_URL</code> for <code>ogc_service_url</code>.</p>
<p>Main optional QWC services:
 * <code>auth_service_url</code>: QWC Auth Service URL
 * <code>data_service_url</code>: QWC Data Service URL
 * <code>elevation_service_url</code>: QWC Elevation Service URL
 * <code>info_service_url</code>: QWC FeatureInfo Service URL
 * <code>legend_service_url</code>: QWC Legend Service URL
 * <code>permalink_service_url</code>: QWC Permalink Service URL
 * <code>print_service_url</code>: QWC Print Service URL
 * <code>proxy_service_url</code>: Proxy Service URL
 * <code>search_service_url</code>: QWC Search Service URL
 * <code>search_data_service_url</code>: QWC Search Result Service URL</p>
<p>Additional user info fields may be read from the JWT identity by setting <code>user_info_fields</code>:</p>
<pre><code class="language-json">&quot;config&quot;: {
  &quot;user_info_fields&quot;: [&quot;surname&quot;, &quot;first_name&quot;]
}
</code></pre>
<p>These will be added as <code>user_infos</code> in the <code>config.json</code> response if present in the current identity.</p>
<p><code>qwc2_config</code> contains the QWC2 application configuration, with <code>config</code> corresponding to the contents of your standalone <code>config.json</code> file (see <a href="https://github.com/qgis/qwc2-demo-app/blob/master/doc/src/qwc_configuration.md#application-configuration-the-configjson-and-jsappconfigjs-files">Documentation</a>).</p>
<p><code>qwc2_themes</code> contains the full themes configuration, corresponding to the contents of your standalone <code>themes.json</code> collected from <code>themesConfig.json</code>.</p>
<p>Add new themes to your <code>themesConfig.json</code> (see <a href="https://github.com/qgis/qwc2-demo-app/blob/master/doc/src/qwc_configuration.md#theme-configuration-qgis-projects-and-the-themesconfigjson-file">Documentation</a>) and put any theme thumbnails into <code>$QWC2_PATH/assets/img/mapthumbs/</code>.
The <code>themesConfig.json</code> file is used to collect the full themes configuration using GetProjectSettings.</p>
<p>Optional settings for restricted themes:</p>
<pre><code class="language-json">&quot;config&quot;: {
  &quot;show_restricted_themes&quot;: false,
  &quot;show_restricted_themes_whitelist&quot;: [],
  &quot;redirect_restricted_themes_to_auth&quot;: false,
  &quot;internal_permalink_service_url&quot;: &quot;http://qwc-permalink-service:9090&quot;
}
</code></pre>
<ul>
<li><code>show_restricted_themes</code> (optional): Whether to insert placeholder items for restricted themes in themes.json (default: <code>false</code>)</li>
<li><code>show_restricted_themes_whitelist</code> (optional): Whitelist of restricted theme names to include in themes.json. If empty, all restricted themes are shown. (default: <code>[]</code>)</li>
<li><code>redirect_restricted_themes_to_auth</code> (optional): Whether to redirect to login on auth service if requesting a restricted theme in URL params, if not currently signed in (default: <code>false</code>)</li>
<li><code>internal_permalink_service_url</code> (optional): Internal Permalink service URL for getting the theme from a resolved permalink for redirecting to login (default: <code>http://qwc-permalink-service:9090</code>). This is used only if <code>redirect_restricted_themes_to_auth</code> is enabled and <code>permalink_service_url</code> is set.</li>
</ul>
<h3 id="permissions">Permissions<a class="headerlink" href="#permissions" title="Permanent link">&para;</a></h3>
<ul>
<li>File location: <code>$CONFIG_PATH/&lt;tenant&gt;/permissions.json</code></li>
</ul>
<p>Example:</p>
<pre><code class="language-json">{
  &quot;users&quot;: [
    {
      &quot;name&quot;: &quot;demo&quot;,
      &quot;groups&quot;: [&quot;demo&quot;],
      &quot;roles&quot;: []
    }
  ],
  &quot;groups&quot;: [
    {
      &quot;name&quot;: &quot;demo&quot;,
      &quot;roles&quot;: [&quot;demo&quot;]
    }
  ],
  &quot;roles&quot;: [
    {
      &quot;role&quot;: &quot;public&quot;,
      &quot;permissions&quot;: {
        &quot;viewer_tasks&quot;: [],
        &quot;wms_services&quot;: [
          {
            &quot;name&quot;: &quot;qwc_demo&quot;,
            &quot;layers&quot;: [
              {
                &quot;name&quot;: &quot;qwc_demo&quot;
              },
              {
                &quot;name&quot;: &quot;edit_demo&quot;
              },
              {
                &quot;name&quot;: &quot;edit_points&quot;
              },
              {
                &quot;name&quot;: &quot;edit_lines&quot;
              },
              {
                &quot;name&quot;: &quot;edit_polygons&quot;
              },
              {
                &quot;name&quot;: &quot;geographic_lines&quot;
              },
              {
                &quot;name&quot;: &quot;country_names&quot;
              },
              {
                &quot;name&quot;: &quot;states_provinces&quot;
              },
              {
                &quot;name&quot;: &quot;countries&quot;
              },
              {
                &quot;name&quot;: &quot;bluemarble_bg&quot;
              },
              {
                &quot;name&quot;: &quot;osm_bg&quot;
              }
            ],
            &quot;print_templates&quot;: [&quot;A4 Landscape&quot;]
          }
        ],
        &quot;background_layers&quot;: [&quot;bluemarble&quot;, &quot;mapnik&quot;],
        &quot;data_datasets&quot;: [
          {
            &quot;name&quot;: &quot;qwc_demo.edit_points&quot;,
            &quot;attributes&quot;: [
              &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;
            ]
          }
        ]
      }
    },
    {
      &quot;role&quot;: &quot;demo&quot;,
      &quot;permissions&quot;: {
        &quot;viewer_tasks&quot;: [&quot;RasterExport&quot;]
      }
    }
  ]
}
</code></pre>
<ul>
<li><code>viewer_tasks</code>: permitted menu items if any are restricted</li>
<li><code>wms_services</code>: permitted WMS services, layers and print templates</li>
<li><code>background_layers</code>: permitted background layers</li>
<li><code>data_datasets</code>: permitted datasets for editing</li>
</ul>
<p>In this example, the <em>Raster Export</em> map tool will only be visible for users with the role <code>demo</code>.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>Set the <code>CONFIG_PATH</code> environment variable to the path containing the service config and permission files when starting this service (default: <code>config</code>).</p>
<p>Base URL:</p>
<pre><code>http://localhost:5030/
</code></pre>
<p>Sample requests:</p>
<pre><code>curl 'http://localhost:5030/config.json'
curl 'http://localhost:5030/themes.json'
</code></pre>
<h2 id="docker-images">Docker images<a class="headerlink" href="#docker-images" title="Permanent link">&para;</a></h2>
<p>The following Docker images are available:
* <code>sourcepole/qwc-map-viewer-base</code>: Map viewer service
* <code>sourcepole/qwc-map-viewer-demo</code>: Map viewer service with qwc-demo-app viewer</p>
<p>Dependencies:</p>
<pre><code>    git repos                Docker images

 ┌───────────────┐
 │     qwc2      │
 └───────┬───────┘
         │submodule
 ┌───────▼───────┐
 │ qwc-demo-app  ├────────────┐
 │    config.json│ CI Build   │
 └───────────────┘      ┌─────▼───────────────┐
                     ┌──► qwc-map-viewer-demo │
 ┌───────────────┐   │  └─────────────────────┘
 │ qwc-map-viewer├───┤
 └───────────────┘   │  ┌─────────────────────┐
                     └──► qwc-map-viewer-base │
                        └─────────────────────┘
</code></pre>
<h3 id="run-docker-image">Run docker image<a class="headerlink" href="#run-docker-image" title="Permanent link">&para;</a></h3>
<p>To run this docker image you will need the following three additional services:</p>
<ul>
<li>qwc-postgis</li>
<li>qwc-qgis-server</li>
<li>qwc-ogc-service</li>
<li>qwc-data-service</li>
</ul>
<p>Those services can be found under https://github.com/qwc-services/. The following steps explain how to download those services and how to run the <code>qwc-map-viewer</code> with <code>docker-compose</code>.</p>
<p><strong>Step 1: Clone qwc-docker</strong></p>
<pre><code>git clone https://github.com/qwc-services/qwc-docker
cd qwc-docker
</code></pre>
<p><strong>Step 2: Create docker-compose.yml file</strong></p>
<pre><code>cp docker-compose-example.yml docker-compose.yml
</code></pre>
<p><strong>Step 3: Choose between a version of the qwc-map-viewer</strong></p>
<h4 id="qwc-map-viewer-demo">qwc-map-viewer-demo<a class="headerlink" href="#qwc-map-viewer-demo" title="Permanent link">&para;</a></h4>
<p>This is the demo version used in the <code>docker-compose-example.yml</code> file. With this version, the docker image comes with a preinstalled version of the latest qwc2-demo-app build and the python application for the viewer. Use this docker image, if you don't have your own build of the QWC2 app.</p>
<h4 id="qwc-map-viewer-base">qwc-map-viewer-base<a class="headerlink" href="#qwc-map-viewer-base" title="Permanent link">&para;</a></h4>
<p>If you want to use your own QWC2 build then this is the docker image that you want to use. This docker image comes with only the python application installed on. Here is an example, on how you can add you own QWC2 build to the docker image:</p>
<pre><code>qwc-map-viewer:
    image: sourcepole/qwc-map-viewer-base
    ports:
        - &quot;127.0.0.1:5030:9090&quot;
    # Here you mount your own QWC2 build
    volumes:
        - /PATH_TO_QWC2_BUILD/:/qwc2:ro
        - /PATH_TO_CONFIG:/srv/qwc_service/config:ro
</code></pre>
<p><strong>Step 4: Start docker containers</strong></p>
<pre><code>docker-compose up qwc-map-viewer
</code></pre>
<p>For more information please visit: https://github.com/qwc-services/qwc-docker</p>
<h2 id="development">Development<a class="headerlink" href="#development" title="Permanent link">&para;</a></h2>
<p>Create a virtual environment:</p>
<pre><code>virtualenv --python=/usr/bin/python3 --system-site-packages .venv
</code></pre>
<p>Without system packages:</p>
<pre><code>python3 -m venv .venv
</code></pre>
<p>Activate virtual environment:</p>
<pre><code>source .venv/bin/activate
</code></pre>
<p>Install requirements:</p>
<pre><code>pip install -r requirements.txt
</code></pre>
<p>Start local service:</p>
<pre><code>CONFIG_PATH=/PATH/TO/CONFIGS/ python src/server.py
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
      <script src="../../js/version-select.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

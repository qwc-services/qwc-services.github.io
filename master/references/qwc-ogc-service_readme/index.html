<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Qwc ogc service readme - QWC2 - 2024.02.15-master</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../css/custom.css" rel="stylesheet" />
        <link href="../../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Qwc ogc service readme";
        var mkdocs_page_input_path = "references/qwc-ogc-service_readme.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> QWC2 - 2024.02.15-master
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">QWC2</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../QuickStart/">Quick start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">General configuration</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ThemesConfiguration/">Themes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ViewerConfiguration/">Viewer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ResourcesPermissions/">Resources and permissions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../configuration/ServiceConfiguration/">Services</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Selected topics</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Search/">Search</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/FeatureInfo/">Feature info</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Printing/">Printing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Mapinfo/">Map info</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Editing/">Editing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Snapping/">Snapping</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/TimeManager/">Temporal layers</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/LegendGraphics/">Legend graphics</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Interfacing/">Interfacing with applications</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/MultiTenancy/">Multi-tenancy</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../">References</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Version history</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/ChangeLog/">ChangeLog</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/QWC2UpgradeNotes/">QWC2 upgrade notes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/QwcDockerUpgradeNotes/">qwc-docker upgrade notes</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../UserGuide/">User guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../FAQ/">FAQ</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">QWC2 - 2024.02.15-master</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Qwc ogc service readme</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p><a href="https://github.com/qwc-services/qwc-ogc-service/actions"><img alt="" src="https://github.com/qwc-services/qwc-ogc-service/workflows/build/badge.svg" /></a>
<a href="https://hub.docker.com/r/sourcepole/qwc-ogc-service"><img alt="docker" src="https://img.shields.io/docker/v/sourcepole/qwc-ogc-service?label=Docker%20image&amp;sort=semver" /></a></p>
<h1 id="qwc-ogc-service">QWC OGC Service<a class="headerlink" href="#qwc-ogc-service" title="Permanent link">&para;</a></h1>
<p>Provide OGC services with permission filters as a proxy to a QGIS server.</p>
<p><strong>Note:</strong> requires a QGIS server running on <code>default_qgis_server_url</code>.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h2>
<p>The static config and permission files are stored as JSON files in <code>$CONFIG_PATH</code> with subdirectories for each tenant,
e.g. <code>$CONFIG_PATH/default/*.json</code>. The default tenant name is <code>default</code>.</p>
<h3 id="service-config">Service config<a class="headerlink" href="#service-config" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="schemas/qwc-ogc-service.json">JSON schema</a></li>
<li>File location: <code>$CONFIG_PATH/&lt;tenant&gt;/ogcConfig.json</code></li>
</ul>
<p>Example:</p>
<pre><code class="language-json">{
  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/qwc-services/qwc-ogc-service/v2/schemas/qwc-ogc-service.json&quot;,
  &quot;service&quot;: &quot;ogc&quot;,
  &quot;config&quot;: {
    &quot;default_qgis_server_url&quot;: &quot;http://localhost:8001/ows/&quot;
  },
  &quot;resources&quot;: {
    &quot;wms_services&quot;: [
      {
        &quot;name&quot;: &quot;qwc_demo&quot;,
        &quot;wms_url&quot;: &quot;http://localhost:8001/ows/qwc_demo&quot;,
        &quot;online_resources&quot;: {
          &quot;service&quot;: &quot;http://localhost:5013/qwc_demo&quot;,
          &quot;feature_info&quot;: &quot;http://localhost:5013/qwc_demo&quot;,
          &quot;legend&quot;: &quot;http://localhost:5013/qwc_demo&quot;
        },
        &quot;root_layer&quot;: {
          &quot;name&quot;: &quot;qwc_demo&quot;,
          &quot;layers&quot;: [
            {
              &quot;name&quot;: &quot;edit_demo&quot;,
              &quot;layers&quot;: [
                {
                  &quot;name&quot;: &quot;edit_points&quot;,
                  &quot;title&quot;: &quot;Edit Points&quot;,
                  &quot;attributes&quot;: [
                    &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;, &quot;geometry&quot;, &quot;maptip&quot;
                  ],
                  &quot;queryable&quot;: true
                },
                {
                  &quot;name&quot;: &quot;edit_lines&quot;,
                  &quot;title&quot;: &quot;Edit Lines&quot;,
                  &quot;attributes&quot;: [
                    &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;, &quot;geometry&quot;, &quot;maptip&quot;
                  ],
                  &quot;queryable&quot;: true
                },
                {
                  &quot;name&quot;: &quot;edit_polygons&quot;,
                  &quot;title&quot;: &quot;Edit Polygons&quot;,
                  &quot;attributes&quot;: [
                    &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;, &quot;geometry&quot;, &quot;maptip&quot;
                  ],
                  &quot;queryable&quot;: true
                }
              ]
            },
            {
              &quot;name&quot;: &quot;geographic_lines&quot;
            },
            {
              &quot;name&quot;: &quot;country_names&quot;
            },
            {
              &quot;name&quot;: &quot;states_provinces&quot;
            },
            {
              &quot;name&quot;: &quot;countries&quot;,
              &quot;title&quot;: &quot;Countries&quot;,
              &quot;attributes&quot;: [
                &quot;name&quot;, &quot;formal_en&quot;, &quot;pop_est&quot;, &quot;subregion&quot;, &quot;geometry&quot;
              ],
              &quot;queryable&quot;: true
            }
          ]
        },
        &quot;print_url&quot;: &quot;http://localhost:5013/qwc_demo&quot;,
        &quot;print_templates&quot;: [&quot;A4 Landscape&quot;],
        &quot;internal_print_layers&quot;: [&quot;bluemarble_bg&quot;, &quot;osm_bg&quot;]
      }
    ],
    &quot;wfs_services&quot;: [
      {
        &quot;name&quot;: &quot;qwc_demo&quot;,
        &quot;wfs_url&quot;: &quot;http://localhost:8001/ows/qwc_demo_wfs&quot;,
        &quot;online_resource&quot;: &quot;http://localhost:5013/qwc_demo&quot;,
        &quot;layers&quot;: [
          {
            &quot;name&quot;: &quot;edit_points&quot;,
            &quot;attributes&quot;: [
              &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;, &quot;geometry&quot;
            ]
          },
          {
            &quot;name&quot;: &quot;edit_lines&quot;,
            &quot;attributes&quot;: [
              &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;, &quot;geometry&quot;
            ]
          }
        ]
      }
    ]
  }
}
</code></pre>
<p><strong>Note</strong>: <code>wfs_services</code> example for a separate QGIS project <code>qwc_demo_wfs</code> with WFS enabled.</p>
<h3 id="permissions">Permissions<a class="headerlink" href="#permissions" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://github.com/qwc-services/qwc-services-core/blob/master/schemas/qwc-services-permissions.json">JSON schema</a></li>
<li>File location: <code>$CONFIG_PATH/&lt;tenant&gt;/permissions.json</code></li>
</ul>
<p>Example:</p>
<pre><code class="language-json">{
  &quot;$schema&quot;: &quot;https://raw.githubusercontent.com/qwc-services/qwc-services-core/master/schemas/qwc-services-permissions.json&quot;,
  &quot;users&quot;: [
    {
      &quot;name&quot;: &quot;demo&quot;,
      &quot;groups&quot;: [&quot;demo&quot;],
      &quot;roles&quot;: []
    }
  ],
  &quot;groups&quot;: [
    {
      &quot;name&quot;: &quot;demo&quot;,
      &quot;roles&quot;: [&quot;demo&quot;]
    }
  ],
  &quot;roles&quot;: [
    {
      &quot;role&quot;: &quot;public&quot;,
      &quot;permissions&quot;: {
        &quot;wms_services&quot;: [
          {
            &quot;name&quot;: &quot;qwc_demo&quot;,
            &quot;layers&quot;: [
              {
                &quot;name&quot;: &quot;qwc_demo&quot;
              },
              {
                &quot;name&quot;: &quot;edit_demo&quot;
              },
              {
                &quot;name&quot;: &quot;edit_points&quot;,
                &quot;attributes&quot;: [
                  &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;, &quot;geometry&quot;, &quot;maptip&quot;
                ]
              },
              {
                &quot;name&quot;: &quot;edit_lines&quot;,
                &quot;attributes&quot;: [
                  &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;, &quot;geometry&quot;, &quot;maptip&quot;
                ]
              },
              {
                &quot;name&quot;: &quot;edit_polygons&quot;,
                &quot;attributes&quot;: [
                  &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;, &quot;geometry&quot;, &quot;maptip&quot;
                ]
              },
              {
                &quot;name&quot;: &quot;geographic_lines&quot;
              },
              {
                &quot;name&quot;: &quot;country_names&quot;
              },
              {
                &quot;name&quot;: &quot;states_provinces&quot;
              },
              {
                &quot;name&quot;: &quot;countries&quot;,
                &quot;attributes&quot;: [
                  &quot;name&quot;, &quot;formal_en&quot;, &quot;pop_est&quot;, &quot;subregion&quot;, &quot;geometry&quot;
                ]
              },
              {
                &quot;name&quot;: &quot;bluemarble_bg&quot;
              },
              {
                &quot;name&quot;: &quot;osm_bg&quot;
              }
            ],
            &quot;print_templates&quot;: [&quot;A4 Landscape&quot;]
          }
        ]
      },
      &quot;wfs_services&quot;: [
        {
          &quot;name&quot;: &quot;qwc_demo&quot;,
          &quot;layers&quot;: [
            {
              &quot;name&quot;: &quot;edit_points&quot;,
              &quot;attributes&quot;: [
                &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;, &quot;geometry&quot;
              ]
            },
            {
              &quot;name&quot;: &quot;edit_lines&quot;,
              &quot;attributes&quot;: [
                &quot;id&quot;, &quot;name&quot;, &quot;description&quot;, &quot;num&quot;, &quot;value&quot;, &quot;type&quot;, &quot;amount&quot;, &quot;validated&quot;, &quot;datetime&quot;, &quot;geometry&quot;
              ]
            }
          ]
        }
      ]
    }
  ]
}
</code></pre>
<p><strong>Note</strong>: <code>layers</code> in <code>wms_services</code> is a flat list of all permitted layers, group layers and internal print layers.</p>
<h3 id="basic-auth">Basic Auth<a class="headerlink" href="#basic-auth" title="Permanent link">&para;</a></h3>
<p>OGC services can require password authentication using Basic authentication.</p>
<p>Example:</p>
<pre><code class="language-json">  &quot;config&quot;: {
    &quot;default_qgis_server_url&quot;: &quot;http://qwc-qgis-server/ows/&quot;,
    &quot;basic_auth_login_url&quot;: [&quot;http://qwc-auth-service:9090/verify_login&quot;]
  },
</code></pre>
<h3 id="marker-params">Marker params<a class="headerlink" href="#marker-params" title="Permanent link">&para;</a></h3>
<p>The OGC service supports specifying marker parameters to insert a SLD styled marker into GetMap requests via QGIS Server <code>HIGHLIGHT_SYMBOL</code> and <code>HIGHLIGHT_GEOM</code>. To use this feature, provide a SLD template and parameter definitions in the ogc service config, for example:</p>
<pre><code>"marker_template": "&lt;StyledLayerDescriptor&gt;&lt;UserStyle&gt;&lt;se:Name&gt;Marker&lt;/se:Name&gt;&lt;se:FeatureTypeStyle&gt;&lt;se:Rule&gt;&lt;se:Name&gt;Single symbol&lt;/se:Name&gt;&lt;se:PointSymbolizer&gt;&lt;se:Graphic&gt;&lt;se:Mark&gt;&lt;se:WellKnownName&gt;circle&lt;/se:WellKnownName&gt;&lt;se:Fill&gt;&lt;se:SvgParameter name=\"fill\"&gt;$FILL$&lt;/se:SvgParameter&gt;&lt;/se:Fill&gt;&lt;se:Stroke&gt;&lt;se:SvgParameter name=\"stroke\"&gt;$STROKE$&lt;/se:SvgParameter&gt;&lt;se:SvgParameter name=\"stroke-width\"&gt;$STROKE_WIDTH$&lt;/se:SvgParameter&gt;&lt;/se:Stroke&gt;&lt;/se:Mark&gt;&lt;se:Size&gt;$SIZE$&lt;/se:Size&gt;&lt;/se:Graphic&gt;&lt;/se:PointSymbolizer&gt;&lt;/se:Rule&gt;&lt;/se:FeatureTypeStyle&gt;&lt;/UserStyle&gt;&lt;/StyledLayerDescriptor&gt;",
"marker_params": {
  "size": {
    "default": 10,
    "type": "number"
  },
  "fill": {
    "default": "FFFFFF",
    "type": "color"
  },
  "stroke": {
    "default": "FF0000",
    "type": "color"
  },
  "stroke_width": {
    "default": 5,
    "type": "number"
  }
</code></pre>
<p>Note:</p>
<ul>
<li>Use <code>$&lt;PARAM_NAME&gt;$</code> as parameter placeholders in the SLD template.</li>
<li>You can selectively override the default values via environment variables by setting <code>MARKER_&lt;PARAM_NAME&gt;</code> (i.e. <code>MARKER_SIZE</code>) to the desired values.</li>
</ul>
<p>You can then specify the <code>MARKER</code> URL query parameter in <code>GetMap</code> requests to inject a marker as follows:</p>
<pre><code>...?SERVICE=WMS&amp;REQUEST=GetMap&amp;...&amp;MARKER=X-&gt;123456|Y-&gt;123456|STROKE-&gt;000FFA...
</code></pre>
<p><code>X</code> and <code>Y</code> are compulsory and specify the marker position in map CRS, any other additional parameters are optional and will override the default values if provided. All parameters have to written in uppercase.</p>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<p>Set the <code>CONFIG_PATH</code> environment variable to the path containing the service config and permission files when starting this service (default: <code>config</code>).</p>
<p>Set the <code>DEFAULT_QGIS_SERVER_URL</code> environment variable to the QGIS server URL
when starting this service. (default: <code>http://localhost:8001/ows/</code> on
qwc-qgis-server container)</p>
<p>Base URL:</p>
<pre><code>http://localhost:5013/
</code></pre>
<p>Service API:</p>
<pre><code>http://localhost:5013/api/
</code></pre>
<p>Sample requests:</p>
<pre><code>curl 'http://localhost:5013/qwc_demo?VERSION=1.1.1&amp;SERVICE=WMS&amp;REQUEST=GetCapabilities'
</code></pre>
<h2 id="docker-usage">Docker usage<a class="headerlink" href="#docker-usage" title="Permanent link">&para;</a></h2>
<p>To run this docker image you will need a running QGIS server.</p>
<p>The following steps explain how to download the QGIS server docker image and how to run the <code>qwc-ogc-service</code> service with <code>docker-compose</code>.</p>
<p><strong>Step 1: Clone qwc-docker</strong></p>
<pre><code>git clone https://github.com/qwc-services/qwc-docker
cd qwc-docker
</code></pre>
<p><strong>Step 2: Create docker-compose.yml file</strong></p>
<pre><code>cp docker-compose-example.yml docker-compose.yml
</code></pre>
<p><strong>Step 3: Start docker containers</strong></p>
<pre><code>docker-compose up qwc-ogc-service
</code></pre>
<p>For more information please visit: https://github.com/qwc-services/qwc-docker</p>
<h2 id="development">Development<a class="headerlink" href="#development" title="Permanent link">&para;</a></h2>
<p>Create a virtual environment:</p>
<pre><code>virtualenv --python=/usr/bin/python3 --system-site-packages .venv
</code></pre>
<p>Without system packages:</p>
<pre><code>python3 -m venv .venv
</code></pre>
<p>Activate virtual environment:</p>
<pre><code>source .venv/bin/activate
</code></pre>
<p>Install requirements:</p>
<pre><code>pip install -r requirements.txt
pip install flask_cors
</code></pre>
<p>Start local service:</p>
<pre><code>CONFIG_PATH=/PATH/TO/CONFIGS/ python src/server.py
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
      <script src="../../js/version-select.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>

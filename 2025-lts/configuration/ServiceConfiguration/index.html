<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Services - QWC2 - 2025.3-lts</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../css/custom.css" rel="stylesheet" />
        <link href="../../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Services";
        var mkdocs_page_input_path = "configuration/ServiceConfiguration.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> QWC2 - 2025.3-lts
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">QWC2</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../QuickStart/">Quick start</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">General configuration</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../ThemesConfiguration/">Themes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ViewerConfiguration/">Viewer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../ResourcesPermissions/">Resources and permissions</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Services</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#service-overview">Service overview</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#qwc-docker-layout">qwc-docker layout</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#service-configurations">Service configurations</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#enabling-additional-services">Enabling additional services</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#configuration-database">Configuration database</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#database-migrations">Database migrations</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#keeping-qwc-services-up-to-date">Keeping QWC services up to date</a>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Selected topics</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Search/">Search</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/FeatureInfo/">Feature info</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Printing/">Printing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/MapExport/">Map export</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Mapinfo/">Map info</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Editing/">Editing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Snapping/">Snapping</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/TimeManager/">Temporal layers</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/LegendGraphics/">Legend graphics</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/MapFilter/">Map filtering</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Reports/">Reports</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/Interfacing/">Interfacing with applications</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../topics/MultiTenancy/">Multi-tenancy</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../references/">References</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Version history</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/ChangeLog/">ChangeLog</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/QWC2UpgradeNotes/">QWC2 upgrade notes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../release_notes/QwcDockerUpgradeNotes/">qwc-docker upgrade notes</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../UserGuide/">User guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../FAQ/">FAQ</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">QWC2 - 2025.3-lts</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>QWC2 &raquo;</li>
          <li>General configuration &raquo;</li>
      <li>Services</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="qwc-services-configuration">QWC Services configuration<a class="headerlink" href="#qwc-services-configuration" title="Permanent link">&para;</a></h1>
<p>The architecture of <code>qwc-services</code> is as follows:</p>
<p><img alt="QWC Services Arch" src="../../images/qwc-services-arch.png?style=centerme" /></p>
<ul>
<li>API-Gateway: API Gateway, forwards requests to individual services <a href="http://localhost:8088">http://localhost:8088</a></li>
<li>Auth-Service: Authentication service with local user database (default users: admin:admin, demo:demo) <a href="http://localhost:8088/auth/login">http://localhost:8088/auth/login</a></li>
<li>Map viewer: QWC2 map viewer <a href="http://localhost:8088">http://localhost:8088</a></li>
<li>OGC Service: Proxy for WMS/WFS requests filtered by permissions, calls QGIS Server <a href="http://localhost:8088/ows/api">http://localhost:8088/ows/api</a></li>
<li>Admin GUI: Admin GUI <a href="http://localhost:8088/qwc_admin/">http://localhost:8088/qwc_admin/</a></li>
</ul>
<p><code>qwc-docker</code> ships a pre-configured the <code>qwc-services</code> ecosystem as an easy to use application.</p>
<h2 id="service-overview">Service overview<a class="headerlink" href="#service-overview" title="Permanent link">&para;</a></h2>
<p>Following is an overview of existing <code>qwc-services</code>:</p>
<p><strong>Applications</strong>:</p>
<ul>
<li><a href="https://github.com/qwc-services/qwc-map-viewer">QWC2 Map Viewer</a>: The map viewer application</li>
<li><a href="https://github.com/qwc-services/qwc-admin-gui">QWC Admin GUI</a>: Configuration backend for managing users and permissions</li>
<li><a href="https://github.com/qwc-services/qwc-registration-gui">Registration GUI</a>: GUI for registration of new users</li>
</ul>
<p><strong>REST services</strong>:</p>
<ul>
<li><a href="https://github.com/qwc-services/qwc-db-auth">DB auth service</a>: Authentication service with local user database</li>
<li><a href="https://github.com/qwc-services/qwc-ldap-auth">LDAP auth service</a>: LDAP Authentication service</li>
<li><a href="https://github.com/qwc-services/qwc-data-service">Data service</a>: Data edit service, required for QWC2 editing functionality</li>
<li><a href="https://github.com/qwc-services/qwc-document-service">Document service</a>: Service for generating Jasper reports</li>
<li><a href="https://github.com/qwc-services/qwc-elevation-service">Elevation service</a>: Service for providing elevation data, required for QWC2 elevation profile</li>
<li><a href="https://github.com/qwc-services/qwc-feature-info-service">Feature info service</a>: Service for providing enhanced GetFeatureInfo responses to QWC2</li>
<li><a href="https://github.com/qwc-services/qwc-fulltext-search-service">Fulltext search service</a>: Fulltext search service for the QWC2 search functionality</li>
<li><a href="https://github.com/qwc-services/qwc-legend-service">Legend service</a>: Service for providing enhanced legend graphics to QWC2</li>
<li><a href="https://github.com/qwc-services/qwc-mapinfo-service">Mapinfo service</a>: Service for providing additional information to the QWC2 right-click map context popup</li>
<li><a href="https://github.com/qwc-services/qwc-ogc-service">OGC service</a>: Proxy for WMS/WFS requests filtered by permissions, calls QGIS Server</li>
<li><a href="https://github.com/qwc-services/qwc-permalink-service">Permalink service</a>: Service for storing compat permalinks and bookmarks generated by QWC2</li>
<li><a href="https://github.com/qwc-services/qwc-print-service">Print service</a>: Service for enhancing the QWC2 GetPrint requests</li>
</ul>
<p><strong>Configuration database</strong>:</p>
<ul>
<li><a href="https://github.com/qwc-services/qwc-base-db">DB schema and migrations</a></li>
</ul>
<p><strong>Configuration generator</strong>:</p>
<ul>
<li><a href="https://github.com/qwc-services/qwc-config-generator">Configuration generator</a></li>
</ul>
<h2 id="qwc-docker-layout"><code>qwc-docker</code> layout<a class="headerlink" href="#qwc-docker-layout" title="Permanent link">&para;</a></h2>
<p>The layout of the <code>qwc-docker</code> tree is as follows:</p>
<table>
<thead>
<tr>
<th>Path</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>├─ api-gateway/nginx.conf</code></td>
<td>API gateway configuration.</td>
</tr>
<tr>
<td><code>├─ volumes/</code></td>
<td>Contains folders which are mounted into the various containers.</td>
</tr>
<tr>
<td><code>│  ├─ attachments</code></td>
<td>Storage of files uploaded through the QWC2 editing functionality.</td>
</tr>
<tr>
<td><code>│  ├─ config/&lt;tenant&gt;/</code></td>
<td>Service configuration files, generated by <code>qwc-config-generator</code>.</td>
</tr>
<tr>
<td><code>│  ├─ config-in/&lt;tenant&gt;/</code></td>
<td>Input configuration files, processed by the <code>qwc-config-generator</code>.</td>
</tr>
<tr>
<td><code>│  │  ├─ config.json</code></td>
<td>Master configuration for the QWC2 viewer.</td>
</tr>
<tr>
<td><code>│  │  ├─ index.html</code></td>
<td>Viewer entry point.</td>
</tr>
<tr>
<td><code>│  │  ├─ themesConfig.json</code></td>
<td>Themes configuration.</td>
</tr>
<tr>
<td><code>│  │  └─ tenantConfig.json</code></td>
<td>Master configuration file for qwc services.</td>
</tr>
<tr>
<td><code>│  ├─ db/</code></td>
<td>Storage of configuration database (see <a href="#configdb">Config DB</a>).</td>
</tr>
<tr>
<td><code>│  ├─ info-templates/</code></td>
<td>Custom feature-info templates (see <code>qwc-feature-info-service</code>).</td>
</tr>
<tr>
<td><code>│  ├─ jasper-reports/</code></td>
<td>Jasper reports (see <code>qwc-document-service</code>).</td>
</tr>
<tr>
<td><code>│  ├─ legends/</code></td>
<td>Custom legend images (see <code>qwc-legend-service</code>).</td>
</tr>
<tr>
<td><code>│  ├─ qgs-resources/</code></td>
<td>QGIS projects and data referenced by the projects.</td>
</tr>
<tr>
<td><code>│  ├─ qwc2/</code></td>
<td>QWC2 Viewer.</td>
</tr>
<tr>
<td><code>│  └─ solr/</code></td>
<td>Fulltext search index.</td>
</tr>
<tr>
<td><code>├─ docker-compose.yml</code></td>
<td>Container configuration file.</td>
</tr>
<tr>
<td><code>├─ pg_service.conf</code></td>
<td>Database service definitions.</td>
</tr>
<tr>
<td><code>└─ pg_service-write.conf</code></td>
<td>Database service definitions for write connections.</td>
</tr>
</tbody>
</table>
<h2 id="service-configurations">Service configurations<a class="headerlink" href="#service-configurations" title="Permanent link">&para;</a></h2>
<p>The master configuration file for the QWC services is located at <code>qwc-docker/volumes/config-in/&lt;tenant&gt;/tenantConfig.json</code>, where <code>&lt;tenant&gt;</code> is the tenant name, <code>default</code> by default. See <a href="../../topics/MultiTenancy/">Multi Tenancy</a> for more details on tenants.</p>
<p>The file is structured as follows:</p>
<pre><code class="language-json">{
  &quot;$schema&quot;: &quot;https://github.com/qwc-services/qwc-config-generator/raw/master/schemas/qwc-config-generator.json&quot;,
  &quot;service&quot;: &quot;config-generator&quot;,
  &quot;config&quot;: {
    &lt;ConfigGenerator config&gt;
  },
  &quot;themesConfig&quot;: &quot;./themesConfig.json&quot;,
  &quot;services&quot;: [
    {
      &quot;name&quot;: &quot;&lt;service name&quot;,
      &lt;Service config&gt;
    },
    ...
  ]
}
</code></pre>
<p>Refer to the <a href="../../references/qwc-config-generator/"><code>qwc-config-generator</code> schema</a> for the available <code>ConfigGenerator config</code> settings.</p>
<p><code>themesConfig</code> is a relative path to the theme configuration file as documented in <a href="../ThemesConfiguration/#manual-theme-configuration">Theme configuration</a>.</p>
<p>The<code>services</code> block contains the configuration for the individual QWC services, as documented in the <a href="../../references/">reference</a>.</p>
<p><em>Note:</em> All config settings can also be set as environment variables in capitalized form in <code>docker-compose.yml</code>.</p>
<p><em>Note:</em> Some variables must be set as environment variables in <code>docker-compose.yml</code>:</p>
<table>
<thead>
<tr>
<th>ENV</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>INPUT_CONFIG_PATH</code></td>
<td><code>config-in</code></td>
<td>Base path for service configuration files</td>
</tr>
<tr>
<td><code>OUTPUT_CONFIG_PATH</code></td>
<td><code>/tmp</code></td>
<td>Base path for service configuration files</td>
</tr>
<tr>
<td><code>JWT_SECRET_KEY</code></td>
<td><code>********</code></td>
<td>secret key for JWT token</td>
</tr>
<tr>
<td><code>TENANT_URL_RE</code></td>
<td>None</td>
<td>Regex for tenant extraction from base URL. Example: ^https?://.+?/(.+?)/</td>
</tr>
<tr>
<td><code>TENANT_HEADER</code></td>
<td>None</td>
<td>Tenant Header name. Example: Tenant</td>
</tr>
</tbody>
</table>
<h2 id="enabling-additional-services">Enabling additional services<a name="enabling-services"></a><a class="headerlink" href="#enabling-additional-services" title="Permanent link">&para;</a></h2>
<ul>
<li>Add service entry in <code>qwc-services/docker-compose.yml</code>, setting the service mountpoint:</li>
</ul>
<pre><code>SERVICE_MOUNTPOINT=/&lt;mountpoint&gt;
</code></pre>
<p>Example:</p>
<pre><code class="language-yml">  qwc-print-service:
    image: sourcepole/qwc-print-service:vYYYY.MM.DD
    environment:
      &lt;&lt;: *qwc-service-variables
      SERVICE_MOUNTPOINT: '/api/v1/print'
    volumes:
      - ./volumes/config:/srv/qwc_service/config:ro
    ports:
      - &quot;127.0.0.1:5020:9090&quot;
</code></pre>
<ul>
<li>Add corresponding entry in <code>api-gateway/nginx.conf</code>, example:</li>
</ul>
<pre><code class="language-text">  location /api/v1/print {
    proxy_pass http://qwc-print-service:9090;
  }
</code></pre>
<ul>
<li>If necessary, uncomment/add the respective service url (see also the <a href="../../references/qwc-map-viewer/">qwc-map-viewer schema reference</a>) in the <code>mapViewer</code> config block of <code>volumes/config-in/default/tenantConfig.json</code>, i.e.</li>
</ul>
<pre><code class="language-json">  {
    &quot;name&quot;: &quot;mapViewer&quot;,
    &quot;generator_config&quot;: {
      # ...
    },
    &quot;config&quot;: {
      &quot;print_service_url&quot;: &quot;/api/v1/print/&quot;,
      # ...
    }
  }
</code></pre>
<ul>
<li>Add the service configuration block below <code>services</code> in <code>volumes/config-in/default/tenantConfig.json</code>, according to the service config schema, i.e.</li>
</ul>
<pre><code class="language-json">  {
    &quot;name&quot;: &quot;print&quot;,
    &quot;config&quot;: {
      &quot;ogc_service_url&quot;: &quot;http://qwc-ogc-service:9090/&quot;,
      &quot;qgis_server_version&quot;: &quot;3.16&quot;
    }
  }
</code></pre>
<h2 id="configuration-database">Configuration database<a name="configdb"></a><a class="headerlink" href="#configuration-database" title="Permanent link">&para;</a></h2>
<p>The <a href="https://github.com/qwc-services/qwc-base-db">Configuration database</a> (CofigDB) contains the database schema <code>qwc_config</code> for configurations and permissions of QWC services.</p>
<p>This database uses the PostgreSQL connection service <code>qwc_configdb</code> by default, which can be setup for the corresponding database in the PostgreSQL connection service file <code>qwc-docker/pg_service.conf</code>.</p>
<p>To use an external configuration database, either change the connection definition for <code>qwc_configdb</code> in <code>qwc-docker/pg_service.conf</code> or change the <code>config_db_url</code> in <code>qwc-docker/volumes/config-in/&lt;tenant&gt;/tenantConfig.json</code>.</p>
<h3 id="database-migrations">Database migrations<a class="headerlink" href="#database-migrations" title="Permanent link">&para;</a></h3>
<p>Migrations to the ConfigDB are applied automatically by the <code>qwc-base-db-migrate</code> image which is included in the sample <code>docker-compose-example.yml</code>.</p>
<p>To upgrade the ConfigDB to a newer version, it is sufficient to change the version of the image to the desired version, and migrations will be applied automatically next time the application is restarted.</p>
<p>See the <a href="https://github.com/qwc-services/qwc-base-db/"><code>qwc-base-db</code> README</a> for more info.</p>
<h2 id="keeping-qwc-services-up-to-date">Keeping QWC services up to date<a name="upgrading"></a><a class="headerlink" href="#keeping-qwc-services-up-to-date" title="Permanent link">&para;</a></h2>
<p>When using <code>qwc-docker</code>, updating the services is a simple as updating the image tags in <code>qwc-docker/docker-compose.yml</code>.</p>
<p>Two versioning schemes are available:</p>
<ul>
<li><code>vYYYY-MM-DD</code>: These refer to the latest available "development" version of the respective images (i.e. <code>v2023.05.12</code>).</li>
<li><code>vYYYY.X-lts</code>: These refer to the long term support version of the respective images (i.e. <code>v2023.1-lts</code>).</li>
</ul>
<p>You can always check the available tags on dockerhub, for example at <a href="https://hub.docker.com/r/sourcepole/qwc-config-generator">https://hub.docker.com/r/sourcepole/qwc-config-generator</a>.</p>
<p>In particular, to special tags exist, <code>latest</code>, <code>latest-lts</code> and <code>latest-YYYY-lts</code> (i.e. <code>latest-2024-lts</code>) which always refer to the latest available "development" and long term support versions respectively. Note however that using these tags will result in docker automatically pulling new versions when the application is launched, which may be undesired.</p>
<p>The <a href="../../release_notes/QwcDockerUpgradeNotes/"><code>qwc-docker</code> Upgrade Notes</a> documents major changes, and in particular all incompatible changes between releases which require changes to the application specific code and/or configuration.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../ResourcesPermissions/" class="btn btn-neutral float-left" title="Resources and permissions"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../topics/Search/" class="btn btn-neutral float-right" title="Search">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../ResourcesPermissions/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../topics/Search/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
      <script src="../../js/version-select.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
